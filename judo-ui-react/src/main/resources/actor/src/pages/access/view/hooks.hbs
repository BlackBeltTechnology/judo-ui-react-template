{{> fragment.header.hbs }}
// Hook: Access View

import { useTranslation } from 'react-i18next';
import type { {{ getMuiDataGridImportsForHooks }} } from '@mui/x-data-grid';
import { Button } from '@mui/material';
import { LoadingButton } from '@mui/lab';
import { MdiIcon } from '~/components';
import { FilterOption, FilterType } from '~/components-api';
import {
    {{# each (getApiImportsForViewPage page) as |imp| }}
        {{ imp }},
    {{/ each }}
} from '~/generated/data-api';
import { baseColumnConfig, toastConfig } from '~/config';
import { fileHandling, serviceDateToUiDate, serviceTimeToUiTime, PersistedTableData, TableRowAction } from '~/utilities';
import { useL10N } from '~/l10n/l10n-context';
import {
    {{# each (getUniquePageActions page) as |action| }}
        {{# unless (isLinkAction action) }}
            {{# unless action.isFilterAction }}
                {{ actionFunctionHookName action }},
            {{/ unless }}
        {{/ unless }}
    {{/ each }}
} from '../actions';

export const use{{ pageName page }} = (
        data: {{ classDataName page.dataElement.target 'Stored' }},
        editMode: boolean,
        setEditMode: (mode: boolean) => void,
        storeDiff: (attributeName: keyof {{ classDataName page.dataElement.target 'Stored' }}, value: any) => void,
        fetchData: () => Promise<void>,
        {{# each (getPageAssociationTables page) as |table| }}
            fetch{{ firstToUpper table.dataElement.name }}: () => Promise<void>,
        {{/ each }}
    ) => {
    const { t } = useTranslation();
    const { downloadFile, extractFileNameFromToken, uploadFile } = fileHandling();
    const { locale: l10nLocale } = useL10N();

    {{# each (getUniquePageActions page) as |action| }}
        {{# unless (isLinkAction action) }}
            {{# unless action.isFilterAction }}
                {{# unless action.isFilterRelationAction }}
                    const {{ actionFunctionName action }} = {{ actionFunctionHookName action }}();
                {{/ unless }}
            {{/ unless }}
        {{/ unless }}
    {{/ each }}

    const queryCustomizer: {{ classDataName page.dataElement.target 'QueryCustomizer' }} = {
        _mask: '{{ page.formattedMask }}',
    };

    {{# if (hasVisualReferences page) }}
        {{# each (getPageAssociationTables page) as |table| }}
            const {{ table.dataElement.name }}FilterOptions: FilterOption[] = [
                {{# each table.filters as |filter| }}
                    {{# if debugPrint }}// include: actor/src/fragments/table/filter-option.fragment.hbs{{/ if }}
                    {{> actor/src/fragments/table/filter-option.fragment.hbs filter=filter application=application }}
                {{/ each }}
            ];
        {{/ each }}

        return {
            queryCustomizer,
            {{# each (getPageAssociationTables page) as |table| }}
                {{ table.dataElement.name }}FilterOptions,
            {{/ each }}
        };
    {{ else }}
        return {
            queryCustomizer,
        };
    {{/ if }}
};
